# see https://github.com/helm/charts/tree/master/stable/jenkins
# see https://github.com/helm/charts/commits/master/stable/jenkins
# see https://github.com/helm/charts/tree/44fa1cdf53ce77d35b607d9eedbd6dd884eeb020/stable/jenkins
# see https://github.com/jenkinsci/docker
# see https://github.com/jenkinsci/docker-jnlp-slave
# see https://github.com/jenkinsci/configuration-as-code-plugin
# see https://hub.docker.com/r/jenkins/jenkins
# see https://hub.docker.com/r/jenkins/jnlp-slave

clusterZone: cluster.domain
master.tag: 2.222.1
master.serviceType: ClusterIP
master.ingress.enabled: true
master.ingress.apiVersion: networking.k8s.io/v1beta1
master.ingress.hostName: jenkins.rancher.test
master.installPlugins:
  - kubernetes:1.25.2
  - workflow-job:2.38
  - workflow-aggregator:2.6
  - credentials-binding:1.21
  - git:4.2.2
  - bouncycastle-api:2.18
  - command-launcher:1.4
  - jdk-tool:1.4
  - configuration-as-code:1.38 # NB the version must match the one at master.JCasC.pluginVersion (see bellow).
# configure jenkins "as code" using the JCasC plugin.
# the general idea is: you manually configure jenkins as needed using its UI, then compare the generated
# jenkins.yaml file exported from http://jenkins.rancher.test/configuration-as-code/viewExport and apply
# its contents to this "master.JCasC" object.
# see http://jenkins.rancher.test/configuration-as-code/
master.JCasC:
  enabled: true
  pluginVersion: '1.38'
  configScripts:
    welcome-message: |
      jenkins:
        systemMessage: Welcome to our test Jenkins server! This is configured by the configuration-as-code (aka JCasC) plugin.
    master: |
      jenkins:
        labelString: master
        mode: EXCLUSIVE
master.jobs:
  test: |
    <project>
      <actions/>
      <description></description>
      <keepDependencies>false</keepDependencies>
      <properties/>
      <scm class="hudson.scm.NullSCM"/>
      <assignedNode>slave-k8s</assignedNode>
      <canRoam>false</canRoam>
      <disabled>false</disabled>
      <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
      <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
      <triggers/>
      <concurrentBuild>false</concurrentBuild>
      <builders>
        <hudson.tasks.Shell>
          <command>env | sort
    cat /etc/os-release
    which java
    java -version
    </command>
        </hudson.tasks.Shell>
      </builders>
      <publishers/>
      <buildWrappers/>
    </project>
agent.tag: '4.3-1'
agent.customJenkinsLabels:
  - slave-k8s
agent.podName: jenkins-slave-k8s
persistence.storageClass: nfs-client
persistence.size: 1Gi
